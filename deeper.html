<!DOCTYPE html>
<!--[if lte IE 8]> <html class="lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html> <!--<![endif]-->
<head>
<meta charset="utf-8">
<!--
Made in Twine 1.4 (running on Windows 7)

Sugarcane is based on:

TiddlyWiki 1.2.39 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Published under a BSD open source license

Copyright (c) Osmosoft Limited 2005

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<title>Sugarcane</title>
<script title="engine">
(function(){

function clone(a){var b={};for(var property in a){if(typeof a[property]=="object"){try{b[property]=JSON.parse(JSON.stringify(a[property]));continue}catch(e){}}b[property]=a[property]}return b}function insertElement(a,d,f,c,e){var b=document.createElement(d);if(f){b.id=f}if(c){b.className=c}if(e){insertText(b,e)}if(a){a.appendChild(b)}return b}function insertText(a,b){return a.appendChild(document.createTextNode(b))}function removeChildren(a){while(a.hasChildNodes()){a.removeChild(a.firstChild)}}function setPageElement(c,b,a){var place;if(place=(typeof c=="string"?document.getElementById(c):c)){removeChildren(place);if(tale.has(b)){new Wikifier(place,tale.get(b).text)}else{new Wikifier(place,a)}}}function addStyle(b){if(document.createStyleSheet){document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style>"+b+"</style>")}else{var a=document.createElement("style");a.appendChild(document.createTextNode(b));document.getElementsByTagName("head")[0].appendChild(a)}}function alterCSS(text){var imgPassages=tale.lookup("tags","Twine.image");text=text.replace(/\/\*(?:[^\*]|\*(?!\/))*\*\//g,"");return text.replace(new RegExp(Wikifier.imageFormatter.lookahead,"gim"),function(m,p1,p2,p3,src){for(var i=0;i<imgPassages.length;i++){if(imgPassages[i].title==src){src=imgPassages[i].text;break}}return"url("+src+");"})}function setTransitionCSS(styleText){styleText=alterCSS(styleText);var style=document.getElementById("transitionCSS");style.styleSheet?(style.styleSheet.cssText=styleText):(style.innerHTML=styleText)}function throwError(a,b,tooltip){var elem=insertElement(a,"span",null,"marked",b);tooltip&&elem.setAttribute("title",tooltip)}Math.easeInOut=function(a){return(1-((Math.cos(a*Math.PI)+1)/2))};String.prototype.readMacroParams=function(keepquotes){var exec,re=/(?:\s*)(?:(?:"([^"]*)")|(?:'([^']*)')|(?:\[\[((?:[^\]]|\](?!\]))*)\]\])|([^"'\s]\S*))/mg,params=[];do{var val;exec=re.exec(this);if(exec){if(exec[1]){val=exec[1];keepquotes&&(val='"'+val+'"')}else{if(exec[2]){val=exec[2];keepquotes&&(val="'"+val+"'")}else{if(exec[3]){val=exec[3];keepquotes&&(val='"'+val.replace('"','\\"')+'"')}else{if(exec[4]){val=exec[4]}}}}val&&params.push(val)}}while(exec);return params};String.prototype.readBracketedList=function(){var c,b="\\[\\[([^\\]]+)\\]\\]",a="[^\\s$]+",e="(?:"+b+")|("+a+")",d=new RegExp(e,"mg"),f=[];do{c=d.exec(this);if(c){if(c[1]){f.push(c[1])}else{if(c[2]){f.push(c[2])}}}}while(c);return(f)};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")});String.prototype.unDash=function(){var s=this.split("-");if(s.length>1){for(var t=1;t<s.length;t++){s[t]=s[t].substr(0,1).toUpperCase()+s[t].substr(1)}}return s.join("")};Array.prototype.indexOf||(Array.prototype.indexOf=function(b,d){d=(d==null)?0:d;var a=this.length;for(var c=d;c<a;c++){if(this[c]==b){return c}}return -1});(function(){function t(t){this.message=t}var e=window,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.prototype=Error(),t.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){for(var o,n,a=0,i=r,c="";e.charAt(0|a)||(i="=",a%1);c+=i.charAt(63&o>>8-8*(a%1))){if(n=e.charCodeAt(a+=0.75),n>255){throw new t()}o=o<<8|n}return c}),e.atob||(e.atob=function(e){if(e=e.replace(/=+$/,""),1==e.length%4){throw new t()}for(var o,n,a=0,i=0,c="";n=e.charAt(i++);~n&&(o=a%4?64*o+n:n,a++%4)?c+=String.fromCharCode(255&o>>(6&-2*a)):0){n=r.indexOf(n)}return c})})();var hasTransition="transition" in document.documentElement.style||"-webkit-transition" in document.documentElement.style;function fade(f,c){var h;var e=f.cloneNode(true);var g=(c.fade=="in")?1:-1;f.parentNode.replaceChild(e,f);if(c.fade=="in"){h=0;e.style.visibility="visible"}else{h=1}b(e,h);var a=window.setInterval(d,25);function d(){h+=0.05*g;b(e,Math.easeInOut(h));if(((g==1)&&(h>=1))||((g==-1)&&(h<=0))){f.style.visibility=(c.fade=="in")?"visible":"hidden";if(e.parentNode){e.parentNode.replaceChild(f,e)}window.clearInterval(a);if(c.onComplete){c.onComplete.call(f)}}}function b(k,j){var l=Math.floor(j*100);k.style.zoom=1;k.style.filter="alpha(opacity="+l+")";k.style.opacity=j}}var scrollWindowInterval;function scrollWindowTo(e){var d=window.scrollY?window.scrollY:document.body.scrollTop;var g=k(e);var c=Math.abs(d-g);var b=0;var j=(d>g)?-1:1;scrollWindowInterval=window.setInterval(h,25);function h(){b+=0.1;window.scrollTo(0,d+j*(c*Math.easeInOut(b)));if(b>=1){window.clearInterval(scrollWindowInterval)}}function k(o){var p=a(o);var q=p+o.offsetHeight;var l=window.scrollY?window.scrollY:document.body.scrollTop;var m=window.innerHeight?window.innerHeight:document.body.clientHeight;var n=l+m;if(p<l){return p}else{if(q>n){if(o.offsetHeight<m){return(p-(m-o.offsetHeight)+20)}else{return p}}else{return p}}}function a(l){var m=0;while(l.offsetParent){m+=l.offsetTop;l=l.offsetParent}return m}}function delta(old,neu){var vars,ret={};if(old&&neu){for(vars in neu){if(neu[vars]!==old[vars]){ret[vars]=neu[vars]}}}return ret}function History(){this.history=[{passage:null,variables:{},hash:null}]}History.prototype.encodeHistory=function(b,noVars){var ret=".",vars,type,hist=this.history[b],d=this.history[b+1]?delta(this.history[b+1].variables,hist.variables):hist.variables;function vtob(str){try{return window.btoa(unescape(encodeURIComponent(JSON.stringify(str))))}catch(e){return"0"}}if(!hist.passage||hist.passage.id==undefined){return""}ret+=hist.passage.id.toString(36);if(noVars){return ret}for(vars in d){type=typeof d[vars];if(type!="function"&&type!="undefined"){ret+="$"+vtob(vars)+","+vtob(d[vars])}}for(vars in hist.linkVars){type=typeof hist.linkVars[vars];if(type!="function"&&type!="undefined"){ret+="["+vtob(vars)+","+vtob(hist.linkVars[vars])}}return ret};History.prototype.decodeHistory=function(str,prev){var name,splits,variable,c,d,ret={variables:prev.variables||{}},match=/([a-z0-9]+)((?:\$[A-Za-z0-9\+\/=]+,[A-Za-z0-9\+\/=]+)*)((?:\[[A-Za-z0-9\+\/=]+,[A-Za-z0-9\+\/=]+)*)/g.exec(str);function btov(str){try{return JSON.parse(decodeURIComponent(escape(window.atob(str))))}catch(e){return 0}}if(match){name=parseInt(match[1],36);if(!tale.has(name)){return false}if(match[2]){ret.variables||(ret.variables={});splits=match[2].split("$");for(c=0;c<splits.length;c++){variable=splits[c].split(",");d=btov(variable[0]);if(d){ret.variables[d]=btov(variable[1])}}}if(match[3]){ret.linkVars||(ret.linkVars={});splits=match[3].split("[");for(c=0;c<splits.length;c++){variable=splits[c].split(",");d=btov(variable[0]);if(d){ret.linkVars[d]=btov(variable[1])}}}ret.passage=tale.get(name);return ret}};History.prototype.save=function(c){var hist,b,a="";for(b=this.history.length-1;b>=0;b--){hist=this.history[b];if(!hist){break}a+=this.encodeHistory(b)}return"#"+a};History.prototype.restore=function(){var a,b,c,vars;try{if(testplay){this.display(testplay,null,"quietly");return true}if(!window.location.hash||(window.location.hash=="#")){return false}if(window.location.hash.substr(0,2)=="#!"){c=window.location.hash.substr(2).split("_").join(" ");this.display(c,null,"quietly");return true}a=window.location.hash.replace("#","").split(".");for(b=0;b<a.length;b++){vars=this.decodeHistory(a[b],vars||{});if(vars){if(b==a.length-1){vars.variables=this.history[0].variables;for(c in this.history[0].linkVars){vars.variables[c]=this.history[0].linkVars[c]}this.history.unshift(vars);this.display(vars.passage.title,null,"back")}else{this.history.unshift(vars)}}}return true}catch(d){return false}};var version={major:4,minor:0,revision:0,date:new Date("November 28, 2013"),extensions:{}};var testplay,tale,state,prerender={},postrender={},macros=window.macros={};version.extensions.displayMacro={major:2,minor:0,revision:0};macros.display={parameters:[],handler:function(place,macroName,params,parser){var t,j,output,oldDisplayParams,name=parser.fullArgs();if(macroName!="display"){output=macroName;params=name.readMacroParams(true);try{for(j=0;j<params.length;j++){params[j]=eval(Wikifier.parse(params[j]))}}catch(e){throwError(place,"<<"+macroName+" "+name+">> bad argument: "+params[j],parser.fullMatch());return}}else{try{output=eval(name)}catch(e){if(tale.get(name).id){output=name}else{throwError(place,"<<"+macroName+">> bad expression: "+e.message,parser.fullMatch());return}}}t=tale.get(output+"");if(!output){throwError(place,'"'+name+'" did not evaluate to a passage name',parser.fullMatch())}else{if(t.id===undefined){throwError(place,'The "'+output+'" passage does not exist',parser.fullMatch())}else{oldDisplayParams=this.parameters;this.parameters=params;if(t.tags.indexOf("script")>-1){scriptEval(t)}else{new Wikifier(place,tale.get(output+"").processText())}this.parameters=oldDisplayParams}}}};version.extensions.actionsMacro={major:1,minor:2,revision:0};macros.actions={handler:function(a,f,g){var v=state.history[0].variables,e=insertElement(a,"ul");if(!v["actions clicked"]){v["actions clicked"]={}}for(var b=0;b<g.length;b++){if(v["actions clicked"][g[b]]){continue}var d=insertElement(e,"li");var c=Wikifier.createInternalLink(d,g[b],(function(link){return function(){state.history[0].variables["actions clicked"][link]=true}}(g[b])));insertText(c,g[b])}}};version.extensions.printMacro={major:1,minor:1,revision:1};macros.print={handler:function(place,macroName,params,parser){try{var args=parser.fullArgs(macroName!="print"),output=eval(args);if(output!=null&&(typeof output!="number"||!isNaN(output))){new Wikifier(place,output.toString())}}catch(e){throwError(place,"<<print>> bad expression: "+e.message,parser.fullMatch())}}};version.extensions.setMacro={major:1,minor:1,revision:0};macros.set={handler:function(a,b,c,parser){macros.set.run(a,parser.fullArgs(),parser)},run:function(a,expression,parser){try{return eval(Wikifier.parse(expression))}catch(e){throwError(a,"bad expression: "+e.message,parser?parser.fullMatch():expression)}}};version.extensions.ifMacros={major:2,minor:0,revision:0};macros["if"]={handler:function(place,macroName,params,parser){var conditions=[],clauses=[],srcOffset=parser.source.indexOf(">>",parser.matchStart)+2,src=parser.source.slice(srcOffset),endPos=-1,currentCond=parser.fullArgs(),currentClause="",t=0,nesting=0;for(var i=0;i<src.length;i++){if(src.substr(i,9)=="<<endif>>"){nesting--;if(nesting<0){endPos=srcOffset+i+9;conditions.push(currentCond.trim());clauses.push(currentClause);break}}if((src.substr(i,6)=="<<else")&&!nesting){conditions.push(currentCond.trim());clauses.push(currentClause);currentClause="";t=src.indexOf(">>",i+6);if(src.substr(i+6,4)==" if "||src.substr(i+6,3)=="if "){currentCond=Wikifier.parse(src.slice(i+9,t))}else{currentCond="true"}i=t+2}if(src.substr(i,5)=="<<if "){nesting++}currentClause+=src.charAt(i)}try{if(endPos!=-1){parser.nextMatch=endPos;for(i=0;i<clauses.length;i++){if(eval(conditions[i])){new Wikifier(place,clauses[i]);break}}}else{throwError(place,"can't find matching endif",parser.fullMatch())}}catch(e){throwError(place,"<<if>> bad condition: "+e.message,!i?parser.fullMatch():"<<else if "+conditions[i]+">>")}}};macros["else"]=macros.elseif=macros.endif={handler:function(){}};version.extensions.rememberMacro={major:2,minor:0,revision:0};macros.remember={handler:function(place,macroName,params,parser){var variable,value,re,match,statement=params.join(" ");macros.set.run(place,parser.fullArgs());if(!window.localStorage){throwError(place,"<<remember>> can't be used "+(window.location.protocol=="file:"?" by local HTML files ":"")+" in this browser.");return}re=new RegExp(Wikifier.textPrimitives.variable,"g");while(match=re.exec(statement)){variable=match[1];value=state.history[0].variables[variable];try{value=JSON.stringify(value)}catch(e){throwError(place,"can't remember $"+variable+" ("+(typeof value)+")",parser.fullMatch());return}window.localStorage[this.prefix+variable]=value}},init:function(){var i,variable,value;if(tale.has("StoryTitle")){this.prefix="Twine."+tale.get("StoryTitle").text+"."}else{this.prefix="Twine.Untitled Story."}for(i in window.localStorage){if(i.indexOf(this.prefix)==0){variable=i.substr(this.prefix.length);value=window.localStorage[i];try{value=JSON.parse(value);state.history[0].variables[variable]=value}catch(e){}}}},expire:null,prefix:null};version.extensions.forgetMacro={major:1,minor:0,revision:0};macros.forget={handler:function(place,macroName,params){var re,match,variable,statement=params.join(" ");re=new RegExp(Wikifier.textPrimitives.variable,"g");while(match=re.exec(statement)){variable=match[1]+"";delete state.history[0].variables[variable];delete window.localStorage[macros.remember.prefix+variable]}}};version.extensions.SilentlyMacro={major:1,minor:1,revision:0};macros.nobr=macros.silently={handler:function(place,macroName,f,parser){var i,h=insertElement(null,"div"),k=parser.source.indexOf(">>",parser.matchStart)+2,a=parser.source.slice(k),d=-1,c="",l=0;for(i=0;i<a.length;i++){if(a.substr(i,15)=="<<end"+macroName+">>"){if(l==0){d=k+i+15;break}else{l--}}else{if(a.substr(i,12)=="<<"+macroName+">>"){l++}}if(macroName=="nobr"&&a.charAt(i)=="\n"){c+="\u200c"}else{c+=a.charAt(i)}}if(d!=-1){new Wikifier(macroName=="nobr"?place:h,c);parser.nextMatch=d}else{throwError(place,"can't find matching end"+macroName,parser.fullMatch())}}};macros.endsilently={handler:function(){}};version.extensions.choiceMacro={major:2,minor:0,revision:0};macros.choice={handler:function(A,C,D,parser){var link,id,match,temp,text=D[1]||D[0].split("|")[0],clicked=state.history[0].variables["choice clicked"]||(state.history[0].variables["choice clicked"]={}),passage=A;while(passage&&!~passage.className.indexOf("passage")){passage=passage.parentNode}id=(passage&&passage.id.replace(/\|[^\]]*$/,"")+"|"+text);if(id&&clicked[id]){insertElement(A,"span",null,"disabled",text)}else{match=new RegExp(Wikifier.linkFormatter.lookahead).exec(parser.fullArgs());if(match){temp=document.createElement("p");new Wikifier(temp,parser.fullArgs());link=temp.firstChild;A.appendChild(link)}else{link=Wikifier.createInternalLink(A,D[0]);setPageElement(link,null,text)}link.onclick=(function(link,onclick){return function(){onclick&&onclick();clicked[id]=true;link.outerHTML="<span class=disabled>"+link.innerHTML+"</span>"}}(link,link.onclick));link.className+=" "+C}}};version.extensions.backMacro={major:2,minor:0,revision:0};macros.back={labeltext:"&#171; back",handler:function(a,b,e){var labelParam,c,el,labeltouse=this.labeltext,steps=1,stepsParam=e.indexOf("steps"),stepsParam2="";if(stepsParam>0){stepsParam2=e[stepsParam-1];if(stepsParam2[0]=="$"){try{stepsParam2=eval(Wikifier.parse(stepsParam2))}catch(r){throwError(a,b+"Macro bad expression: "+r.message);return}}steps=+stepsParam2;if(steps>=state.history.length-1){steps=state.history.length-2}e.splice(stepsParam-1,2)}labelParam=e.indexOf("label");if(labelParam==-1){labelParam=e.indexOf("labeldefault")}if(labelParam>-1){if(!e[labelParam+1]){throwError(a,e[labelParam]+"keyword needs an additional label parameter");return}labeltouse=e[labelParam+1];if(e[labelParam]=="labeldefault"){this.labeltext=labeltouse}e.splice(labelParam,2)}if(stepsParam<=0){if(e[0]){if(e[0].charAt(0)=="$"){try{e=eval(Wikifier.parse(e[0]))}catch(r){throwError(a,"<<"+b+">> bad expression: "+r.message);return}}else{e=e[0]}if(tale.get(e).id==undefined){throwError(a,'The "'+e+'" passage does not exist');return}for(c=0;c<state.history.length;c++){if(state.history[c].passage.title==e){steps=c;break}}}}el=document.createElement("a");el.className=b;el.onclick=(function(b){return function(){return macros.back.onclick(b=="back",steps)}}(b));el.innerHTML=labeltouse;a.appendChild(el)}};version.extensions.returnMacro={major:2,minor:0,revision:0};macros["return"]={labeltext:"&#171; return",handler:function(a,b,e){macros.back.handler.call(this,a,b,e)}};function Passage(c,b,a,ofunc,okey){this.title=c;if(b){this.id=a;if(ofunc!=null&&typeof ofunc=="function"&&okey!=null){var t=b.firstChild?b.firstChild.nodeValue:"";t=ofunc(t,okey);this.initialText=this.text=Passage.unescapeLineBreaks(t);this.tags=b.getAttribute("tags");if(typeof this.tags=="string"){this.tags=ofunc(this.tags,okey);this.tags=this.tags.readBracketedList()}else{this.tags=[]}}else{this.initialText=this.text=Passage.unescapeLineBreaks(b.firstChild?b.firstChild.nodeValue:"");this.tags=b.getAttribute("tags");if(typeof this.tags=="string"){this.tags=this.tags.readBracketedList()}else{this.tags=[]}}}else{this.initialText=this.text="@@This passage does not exist: "+c+"@@";this.tags=[]}}Passage.unescapeLineBreaks=function(a){if(a&&typeof a=="string"){return a.replace(/\\n/mg,"\n").replace(/\\s/mg,"\\").replace(/\\/mg,"\\").replace(/\r/mg,"")}else{return""}};Passage.prototype.setTags=function(b){var t=this.tags!=null&&this.tags.length?this.tags.join(" "):"";if(t){b.setAttribute("data-tags",this.tags.join(" "))}document.body.setAttribute("data-tags",t)};Passage.prototype.processText=function(){var ret=this.text;if(~this.tags.indexOf("nobr")){ret=ret.replace(/\n/g,"\u200c")}if(~this.tags.indexOf("Twine.image")){ret="[img["+ret+"]]"}return ret};function Tale(){this.passages={};var a,b,c,lines,i,kv,ns,nsc,nope,settings=this.storysettings={lookup:function(a){return !~["0","off","false"].indexOf((this[a]+"").toLowerCase())}},tiddlerTitle="";function deswap(t,k){var i,c,p,p1,up,r="";for(i=0;i<t.length;i++){c=t.charAt(i);up=(c==c.toUpperCase());p=k.indexOf(c.toLowerCase());if(p>-1){p1=p+(p%2==0?1:-1);if(p1>=k.length){p1=p}c=k.charAt(p1);up&&(c=c.toUpperCase())}r=r+c}return r}if(document.normalize){document.normalize()}a=document.getElementById("storeArea").children;for(b=0;b<a.length;b++){c=a[b];if(c.getAttribute&&c.getAttribute("tiddler")=="StorySettings"){lines=new Passage("StorySettings",c,0,null,null).text.split("\n");for(i in lines){if(typeof lines[i]=="string"&&lines[i].indexOf(":")>-1){kv=lines[i].split(":");kv[0]=kv[0].replace(/^\s+|\s+$/g,"");kv[1]=kv[1].replace(/^\s+|\s+$/g,"");settings[kv[0]]=kv[1]}}}}if(settings.obfuscate=="swap"&&settings.obfuscatekey){ns="";nope=':\\"n0';if(settings.obfuscatekey=="rot13"){settings.obfuscatekey="anbocpdqerfsgthuivjwkxlymz"}for(i=0;i<settings.obfuscatekey.length;i++){nsc=settings.obfuscatekey[i];if(ns.indexOf(nsc)==-1&&nope.indexOf(nsc)==-1){ns=ns+nsc}}settings.obfuscatekey=ns;for(b=0;b<a.length;b++){c=a[b];if(c.getAttribute&&(tiddlerTitle=c.getAttribute("tiddler"))){if(tiddlerTitle!="StorySettings"){tiddlerTitle=deswap(tiddlerTitle,settings.obfuscatekey)}this.passages[tiddlerTitle]=new Passage(tiddlerTitle,c,b+1,deswap,settings.obfuscatekey)}}}else{for(b=0;b<a.length;b++){c=a[b];if(c.getAttribute&&(tiddlerTitle=c.getAttribute("tiddler"))){this.passages[tiddlerTitle]=new Passage(tiddlerTitle,c,b,null,null)}}}this.title=(this.passages.StoryTitle?this.passages.StoryTitle.text:document.title)}Tale.prototype.has=function(a){if(typeof a=="string"){return(this.passages[a]!=null)}else{for(var i in this.passages){if(this.passages[i].id==a){return true}}return false}};Tale.prototype.get=function(a){if(typeof a=="string"){return this.passages[a]||new Passage(a)}else{for(var i in this.passages){if(this.passages[i].id==a){return this.passages[i]}}}};Tale.prototype.lookup=function(h,g,a){var d=[];for(var c in this.passages){var f=this.passages[c];for(var b=0;b<f[h].length;b++){if(f[h][b]==g){d.push(f)}}}if(!a){a="title"}d.sort(function(k,j){if(k[a]==j[a]){return(0)}else{return(k[a]<j[a])?-1:+1}});return d};Tale.prototype.canUndo=function(){return this.storysettings.lookup("undo")};Tale.prototype.forEachStylesheet=function(tags,callback){var passage,i;tags=tags||[];if(typeof callback!="function"){return}for(passage in this.passages){passage=tale.passages[passage];if(passage&&~passage.tags.indexOf("stylesheet")){for(i=0;i<tags.length;i++){if(~passage.tags.indexOf(tags[i])){callback(passage);break}}}}};function Wikifier(place,source){this.source=source;this.output=place;this.nextMatch=0;this.assembleFormatterMatches(Wikifier.formatters);this.subWikify(this.output)}Wikifier.prototype.assembleFormatterMatches=function(formatters){this.formatters=[];var pattern=[];for(var n=0;n<formatters.length;n++){pattern.push("("+formatters[n].match+")");this.formatters.push(formatters[n])}this.formatterRegExp=new RegExp(pattern.join("|"),"mg")};Wikifier.prototype.subWikify=function(output,terminator){var terminatorMatch,formatterMatch,oldOutput=this.output;this.output=output;var terminatorRegExp=terminator?new RegExp("("+terminator+")","mg"):null;do{this.formatterRegExp.lastIndex=this.nextMatch;if(terminatorRegExp){terminatorRegExp.lastIndex=this.nextMatch}formatterMatch=this.formatterRegExp.exec(this.source);terminatorMatch=terminatorRegExp?terminatorRegExp.exec(this.source):null;if(terminatorMatch&&(!formatterMatch||terminatorMatch.index<=formatterMatch.index)){if(terminatorMatch.index>this.nextMatch){this.outputText(this.output,this.nextMatch,terminatorMatch.index)}this.matchStart=terminatorMatch.index;this.matchLength=terminatorMatch[1].length;this.matchText=terminatorMatch[1];this.nextMatch=terminatorMatch.index+terminatorMatch[1].length;this.output=oldOutput;return}else{if(formatterMatch){if(formatterMatch.index>this.nextMatch){this.outputText(this.output,this.nextMatch,formatterMatch.index)}this.matchStart=formatterMatch.index;this.matchLength=formatterMatch[0].length;this.matchText=formatterMatch[0];this.nextMatch=this.formatterRegExp.lastIndex;var matchingFormatter=-1;for(var t=1;t<formatterMatch.length;t++){if(formatterMatch[t]){matchingFormatter=t-1}}if(matchingFormatter!=-1){this.formatters[matchingFormatter].handler(this)}}}}while(terminatorMatch||formatterMatch);if(this.nextMatch<this.source.length){this.outputText(this.output,this.nextMatch,this.source.length);this.nextMatch=this.source.length}this.output=oldOutput};Wikifier.prototype.outputText=function(place,startPos,endPos){insertText(place,this.source.substring(startPos,endPos))};Wikifier.prototype.fullMatch=function(){return this.source.slice(this.matchStart,this.source.indexOf(">>",this.matchStart)+2)};Wikifier.prototype.fullArgs=function(includeName){var startPos=this.source.indexOf(includeName?"<<":" ",this.matchStart)+(includeName?2:1),endPos=this.source.indexOf(">>",this.matchStart);if(startPos<this.matchStart||endPos<this.matchStart){return""}return Wikifier.parse(this.source.slice(startPos,endPos).trim())};Wikifier.parse=function(input){var m,re,b=input,found=[],g="(?=(?:[^\"'\\\\]*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"))*[^'\"]*$)";function alter(from,to){return b.replace(new RegExp(from+g,"gi"),to)}re=new RegExp(Wikifier.textPrimitives.variable,"gi");while(m=re.exec(input)){if(!~found.indexOf(m[0])){b=m[0]+" == null && ("+m[0]+" = 0);"+b;found.push(m[0])}}b=alter(Wikifier.textPrimitives.variable,"state.history[0].variables.$1");b=alter("\\beq\\b"," == ");b=alter("\\bneq\\b"," != ");b=alter("\\bgt\\b"," > ");b=alter("\\bgte\\b"," >= ");b=alter("\\blt\\b"," < ");b=alter("\\blte\\b"," <= ");b=alter("\\band\\b"," && ");b=alter("\\bor\\b"," || ");b=alter("\\bnot\\b"," ! ");b=alter("\\bis\\b"," == ");b=alter("\\bto\\b"," = ");return b};Wikifier.formatHelpers={charFormatHelper:function(a){var b=insertElement(a.output,this.element);a.subWikify(b,this.terminator)},inlineCssHelper:function(w){var s,v,lookaheadMatch,gotMatch,styles=[],lookahead="(?:("+Wikifier.textPrimitives.anyLetter+"+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:("+Wikifier.textPrimitives.anyLetter+"+):([^;\\|\\n]+);)",lookaheadRegExp=new RegExp(lookahead,"mg"),hadStyle=false;do{lookaheadRegExp.lastIndex=w.nextMatch;lookaheadMatch=lookaheadRegExp.exec(w.source);gotMatch=lookaheadMatch&&lookaheadMatch.index==w.nextMatch;if(gotMatch){hadStyle=true;if(lookaheadMatch[1]){s=lookaheadMatch[1].unDash();v=lookaheadMatch[2]}else{s=lookaheadMatch[3].unDash();v=lookaheadMatch[4]}switch(s){case"bgcolor":s="backgroundColor";break;case"float":s="cssFloat";break}styles.push({style:s,value:v});w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}while(gotMatch);return styles},monospacedByLineHelper:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){var text=lookaheadMatch[1];if(navigator.userAgent.indexOf("msie")!=-1&&navigator.userAgent.indexOf("opera")==-1){text=text.replace(/\n/g,"\r")}var e=insertElement(w.output,"pre",null,null,text);w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}};Wikifier.formatters=[{name:"table",match:"^\\|(?:[^\\n]*)\\|(?:[fhc]?)$",lookahead:"^\\|([^\\n]*)\\|([fhc]?)$",rowTerminator:"\\|(?:[fhc]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[fhc]?$\\n?)",cellTerminator:"(?:\\x20*)\\|",rowTypes:{"c":"caption","h":"thead","":"tbody","f":"tfoot"},handler:function(w){var rowContainer,rowElement,lookaheadMatch,matched,table=insertElement(w.output,"table"),lookaheadRegExp=new RegExp(this.lookahead,"mg"),currRowType=null,nextRowType,prevColumns=[],rowCount=0;w.nextMatch=w.matchStart;do{lookaheadRegExp.lastIndex=w.nextMatch;lookaheadMatch=lookaheadRegExp.exec(w.source),matched=lookaheadMatch&&lookaheadMatch.index==w.nextMatch;if(matched){nextRowType=lookaheadMatch[2];if(nextRowType!=currRowType){rowContainer=insertElement(table,this.rowTypes[nextRowType])}currRowType=nextRowType;if(currRowType=="c"){if(rowCount==0){rowContainer.setAttribute("align","top")}else{rowContainer.setAttribute("align","bottom")}w.nextMatch=w.nextMatch+1;w.subWikify(rowContainer,this.rowTerminator)}else{rowElement=insertElement(rowContainer,"tr");this.rowHandler(w,rowElement,prevColumns)}rowCount++}}while(matched)},rowHandler:function(w,e,prevColumns){var cellMatch,matched,col=0,currColCount=1,cellRegExp=new RegExp(this.cellPattern,"mg");do{cellRegExp.lastIndex=w.nextMatch;cellMatch=cellRegExp.exec(w.source);matched=cellMatch&&cellMatch.index==w.nextMatch;if(matched){if(cellMatch[1]=="~"){var last=prevColumns[col];if(last){last.rowCount++;last.element.setAttribute("rowSpan",last.rowCount);last.element.setAttribute("rowspan",last.rowCount);last.element.valign="center"}w.nextMatch=cellMatch.index+cellMatch[0].length-1}else{if(cellMatch[1]==">"){currColCount++;w.nextMatch=cellMatch.index+cellMatch[0].length-1}else{if(cellMatch[2]){w.nextMatch=cellMatch.index+cellMatch[0].length;break}else{var spaceLeft=false,spaceRight=false,lastColCount,lastColElement,styles,cell,t;w.nextMatch++;styles=Wikifier.formatHelpers.inlineCssHelper(w);while(w.source.substr(w.nextMatch,1)==" "){spaceLeft=true;w.nextMatch++}if(w.source.substr(w.nextMatch,1)=="!"){cell=insertElement(e,"th");w.nextMatch++}else{cell=insertElement(e,"td")}prevColumns[col]={rowCount:1,element:cell};lastColCount=1;lastColElement=cell;if(currColCount>1){cell.setAttribute("colSpan",currColCount);cell.setAttribute("colspan",currColCount);currColCount=1}for(t=0;t<styles.length;t++){cell.style[styles[t].style]=styles[t].value}w.subWikify(cell,this.cellTerminator);if(w.matchText.substr(w.matchText.length-2,1)==" "){spaceRight=true}if(spaceLeft&&spaceRight){cell.align="center"}else{if(spaceLeft){cell.align="right"}else{if(spaceRight){cell.align="left"}}}w.nextMatch=w.nextMatch-1}}}col++}}while(matched)}},{name:"rule",match:"^----$\\n?",handler:function(w){insertElement(w.output,"hr")}},{name:"emdash",match:"--",handler:function(a){insertElement(a.output,"span",null,"char "+(a.matchText==" "?"space":a.matchText),a.matchText)}},{name:"heading",match:"^!{1,5}",terminator:"\\n",handler:function(w){var e=insertElement(w.output,"h"+w.matchLength);w.subWikify(e,this.terminator)}},{name:"monospacedByLine",match:"^\\{\\{\\{\\n",lookahead:"^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)",handler:Wikifier.formatHelpers.monospacedByLineHelper},{name:"monospacedByLineForPlugin",match:"^//\\{\\{\\{\\n",lookahead:"^//\\{\\{\\{\\n\\n*((?:^[^\\n]*\\n)+?)(\\n*^//\\}\\}\\}$\\n?)",handler:Wikifier.formatHelpers.monospacedByLineHelper},{name:"wikifyCommentForPlugin",match:"^/\\*\\*\\*\\n",terminator:"^\\*\\*\\*/\\n",handler:function(w){w.subWikify(w.output,this.terminator)}},{name:"quoteByBlock",match:"^<<<\\n",terminator:"^<<<\\n",handler:function(w){var e=insertElement(w.output,"blockquote");w.subWikify(e,this.terminator)}},{name:"quoteByLine",match:"^>+",terminator:"\\n",element:"blockquote",handler:function(w){var lookaheadRegExp=new RegExp(this.match,"mg");var placeStack=[w.output];var currLevel=0;var newLevel=w.matchLength;var t;do{if(newLevel>currLevel){for(t=currLevel;t<newLevel;t++){placeStack.push(insertElement(placeStack[placeStack.length-1],this.element))}}else{if(newLevel<currLevel){for(t=currLevel;t>newLevel;t--){placeStack.pop()}}}currLevel=newLevel;w.subWikify(placeStack[placeStack.length-1],this.terminator);lookaheadRegExp.lastIndex=w.nextMatch;var lookaheadMatch=lookaheadRegExp.exec(w.source);var matched=lookaheadMatch&&lookaheadMatch.index==w.nextMatch;if(matched){newLevel=lookaheadMatch[0].length;w.nextMatch+=lookaheadMatch[0].length;insertElement(placeStack[placeStack.length-1],"br")}}while(matched)}},{name:"list",match:"^(?:(?:\\*+)|(?:#+))",lookahead:"^(?:(\\*+)|(#+))",terminator:"\\n",outerElement:"ul",itemElement:"li",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");w.nextMatch=w.matchStart;var placeStack=[w.output];var currType=null,newType;var currLevel=0,newLevel;var t;do{lookaheadRegExp.lastIndex=w.nextMatch;var lookaheadMatch=lookaheadRegExp.exec(w.source);var matched=lookaheadMatch&&lookaheadMatch.index==w.nextMatch;if(matched){if(lookaheadMatch[1]){newType="ul"}if(lookaheadMatch[2]){newType="ol"}newLevel=lookaheadMatch[0].length;w.nextMatch+=lookaheadMatch[0].length;if(newLevel>currLevel){for(t=currLevel;t<newLevel;t++){placeStack.push(insertElement(placeStack[placeStack.length-1],newType))}}else{if(newLevel<currLevel){for(t=currLevel;t>newLevel;t--){placeStack.pop()}}else{if(newLevel==currLevel&&newType!=currType){placeStack.pop();placeStack.push(insertElement(placeStack[placeStack.length-1],newType))}}}currLevel=newLevel;currType=newType;var e=insertElement(placeStack[placeStack.length-1],"li");w.subWikify(e,this.terminator)}}while(matched)}},(Wikifier.linkFormatter={name:"prettyLink",match:"\\[\\[",lookahead:"\\[\\[([^\\|\\]]*?)(?:\\|(.*?))?\\](?:\\[(.*?)])?\\]",callback:function(out,text){return function(){macros.set.run(out,text)}},handler:function(w){var title,link,callback,lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){if(lookaheadMatch[3]){callback=this.callback(w.output,lookaheadMatch[3])}if(!lookaheadMatch[2]){title=Wikifier.parsePassageTitle(lookaheadMatch[1]);link=Wikifier.createInternalLink(w.output,title,callback);setPageElement(link,null,title)}else{title=Wikifier.parsePassageTitle(lookaheadMatch[2]);if(tale.has(title)||!title){link=Wikifier.createInternalLink(w.output,title,callback)}else{link=Wikifier.createExternalLink(w.output,lookaheadMatch[2],callback)}setPageElement(link,null,w.source.substring(w.nextMatch,w.nextMatch+lookaheadMatch[1].length))}w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}}),{name:"urlLink",match:"(?:http|https|mailto|ftp):[^\\s'\"]+(?:/|\\b)",handler:function(w){var e=Wikifier.createExternalLink(w.output,w.matchText);w.outputText(e,w.matchStart,w.nextMatch)}},(Wikifier.imageFormatter={name:"image",match:"\\[(?:[<]{0,1})(?:[>]{0,1})[Ii][Mm][Gg]\\[",lookahead:"\\[([<]?)(>?)img\\[(?:([^\\|\\]]+)\\|)?([^\\[\\]\\|]+)\\](?:\\[([^\\]]*)\\]?)?(\\])",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mig");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){var e=w.output,title=Wikifier.parsePassageTitle(lookaheadMatch[5]);if(title){if(tale.has(title)){e=Wikifier.createInternalLink(w.output,title)}else{e=Wikifier.createExternalLink(w.output,title)}}var img=insertElement(e,"img");if(lookaheadMatch[1]){img.align="left"}else{if(lookaheadMatch[2]){img.align="right"}}if(lookaheadMatch[3]){img.title=lookaheadMatch[3]}img.src=lookaheadMatch[4];var imgPassages=tale.lookup("tags","Twine.image");for(var j=0;j<imgPassages.length;j++){if(imgPassages[j].title==lookaheadMatch[4]){img.src=imgPassages[j].text;break}}w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}}),{name:"macro",match:"<<",lookahead:"<<([^>\\s]+)(?:\\s*)((?:[^>]|>(?!>))*)>>",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart&&lookaheadMatch[1]){var params=lookaheadMatch[2].readMacroParams();w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length;var name=lookaheadMatch[1];try{var macro=macros[name];if(macro&&macro.handler){macro.handler(w.output,name,params,w)}else{if(name[0]=="$"){macros.print.handler(w.output,name,[name].concat(params),w)}else{if(tale.has(name)){macros.display.handler(w.output,name,[name].concat(params),w)}else{throwError(w.output,"Macro not found: "+name,w.fullMatch())}}}}catch(e){throwError(w.output,"Error executing macro "+name+": "+e.toString(),w.fullMatch())}}}},{name:"html",match:"<html>",lookahead:"<html>((?:.|\\n)*?)</html>",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){var e=insertElement(w.output,"span");e.innerHTML=lookaheadMatch[1];w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}},{name:"commentByBlock",match:"/%",lookahead:"/%((?:.|\\n)*?)%/",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}},{name:"boldByChar",match:"''",terminator:"''",element:"strong",handler:Wikifier.formatHelpers.charFormatHelper},{name:"strikeByChar",match:"==",terminator:"==",element:"strike",handler:Wikifier.formatHelpers.charFormatHelper},{name:"underlineByChar",match:"__",terminator:"__",element:"u",handler:Wikifier.formatHelpers.charFormatHelper},{name:"italicByChar",match:"//",terminator:"//",element:"em",handler:Wikifier.formatHelpers.charFormatHelper},{name:"subscriptByChar",match:"~~",terminator:"~~",element:"sub",handler:Wikifier.formatHelpers.charFormatHelper},{name:"superscriptByChar",match:"\\^\\^",terminator:"\\^\\^",element:"sup",handler:Wikifier.formatHelpers.charFormatHelper},{name:"monospacedByChar",match:"\\{\\{\\{",lookahead:"\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){var e=insertElement(w.output,"code",null,null,lookaheadMatch[1]);w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}},{name:"styleByChar",match:"@@",terminator:"@@",lookahead:"(?:([^\\(@]+)\\(([^\\)]+)(?:\\):))|(?:([^:@]+):([^;]+);)",handler:function(w){var e=insertElement(w.output,"span",null,null,null);var styles=Wikifier.formatHelpers.inlineCssHelper(w);if(styles.length==0){e.className="marked"}else{for(var t=0;t<styles.length;t++){e.style[styles[t].style]=styles[t].value}}w.subWikify(e,this.terminator)}},{name:"lineBreak",match:"\\n",handler:function(w){insertElement(w.output,"br")}},{name:"continuedLine",match:"\\\\\\s*?\\n",handler:function(a){a.nextMatch=a.matchStart+2}},{name:"htmltag",match:"<\\w+(?:(?:\\s+\\w+(?:\\s*=\\s*(?:\".*?\"|'.*?'|[^'\">\\s]+))?)+\\s*|\\s*)\\/?>",tagname:"<(\\w+)",voids:["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],handler:function(a){var e,isvoid,lookaheadRegExp,lookaheadMatch,lookahead,re=new RegExp(this.tagname).exec(a.matchText),tn=re&&re[1];if(tn&&tn.toLowerCase()!="html"){lookahead="<\\/\\s*"+tn+"\\s*>";isvoid=(this.voids.indexOf(tn.toLowerCase())!=-1);lookaheadRegExp=new RegExp(lookahead,"mg");lookaheadRegExp.lastIndex=a.matchStart;lookaheadMatch=lookaheadRegExp.exec(a.source);if(lookaheadMatch||isvoid){e=document.createElement(a.output.tagName);e.innerHTML=a.matchText;e=e.firstChild;if(!isvoid){a.subWikify(e,lookahead)}a.output.appendChild(e)}else{throwError(a.output,"HTML tag '"+tn+"' wasn't closed.",a.matchText)}}}},{name:"char",match:".",handler:function(a){insertElement(a.output,"span",null,"char "+(a.matchText==" "?"space":a.matchText),a.matchText)}}];Wikifier.parsePassageTitle=function(title){if(title&&!tale.has(title)){try{title=eval(this.parse(title));title&&(title+="")}catch(e){}}return title};Wikifier.createExternalLink=function(place,url){var el=insertElement(place,"a");el.href=url;el.className="externalLink";el.target="_blank";if(place){place.appendChild(el)}return el};if(!((new RegExp("[\u0150\u0170]","g")).test("\u0150"))){Wikifier.textPrimitives={upperLetter:"[A-Z\u00c0-\u00de]",lowerLetter:"[a-z\u00df-\u00ff_0-9\\-]",anyLetter:"[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-]"}}else{Wikifier.textPrimitives={upperLetter:"[A-Z\u00c0-\u00de\u0150\u0170]",lowerLetter:"[a-z\u00df-\u00ff_0-9\\-\u0151\u0171]",anyLetter:"[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-\u0150\u0170\u0151\u0171]"}}Wikifier.textPrimitives.variable="\\$((?:"+Wikifier.textPrimitives.anyLetter.replace("\\-","\\.")+"*"+Wikifier.textPrimitives.anyLetter.replace("0-9\\-","\\.")+"+"+Wikifier.textPrimitives.anyLetter.replace("\\-","\\.")+"*"+"|\\[[^\\]]+\\])+)";function visited(e){var ret=0,i=0;e=e||state.history[0].passage.title;if(arguments.length>1){for(ret=state.history.length;i<arguments.length;i++){ret=Math.min(ret,visited(arguments[i]))}}else{for(;i<state.history.length&&state.history[i].passage;i++){if(~e.indexOf(state.history[i].passage.title)){ret++}}}return ret}function previous(){if(state.history[1]){for(var d=1;d<state.history.length&&state.history[d].passage;d++){if(state.history[d].passage.title!=state.history[0].passage.title){return state.history[d].passage.title}}}return""}function either(){return arguments[~~(Math.random()*arguments.length)]}function parameter(n){n=n||0;if(macros.display.parameters[n]){return macros.display.parameters[n]}throw new RangeError("there isn't a parameter "+n)}function scriptEval(s){try{eval(s.text)}catch(e){alert("There is a technical problem with this story ("+s.title+": "+e.message+"). You may be able to continue reading, but parts of the story may not work properly.")}}var $;function main(){$=window.$||function(a){return(typeof a=="string"?document.getElementById(a):a)};var imgs,scripts,macro,style,styleText="",i,p=document.getElementById("passages");if(!window.JSON){return(p.innerHTML="This story requires a newer web browser. Sorry.")}else{p.innerHTML=""}tale=window.tale=new Tale();state=window.state=new History();document.title=tale.title;if(~document.documentElement.className.indexOf("lt-ie9")){imgs=tale.lookup("tags","Twine.image");for(i=0;i<imgs.length;i++){if(imgs[i].text.length>=32768){alert("NOTE: This story's HTML file contains embedded images that may be too large for this browser to display.");break}}}setPageElement("storyTitle","StoryTitle","Untitled Story");setPageElement("storySubtitle","StorySubtitle","");if(tale.has("StoryAuthor")){setPageElement("titleSeparator",null,"\n");setPageElement("storyAuthor","StoryAuthor","")}if(tale.has("StoryMenu")){document.getElementById("storyMenu").style.display="inline";setPageElement("storyMenu","StoryMenu","")}scripts=tale.lookup("tags","script");for(i=0;i<scripts.length;i++){scriptEval(scripts[i])}for(macro in macros){macro=macros[macro];if(typeof macro.init=="function"){macro.init()}}style=document.getElementById("storyCSS");for(i in tale.passages){i=tale.passages[i];if(i.tags+""=="stylesheet"){styleText+=alterCSS(i.text)}else{if(i.tags.length==2&&i.tags.indexOf("transition")>-1&&i.tags.indexOf("stylesheet")>-1){setTransitionCSS(i.text)}}}style.styleSheet?(style.styleSheet.cssText=styleText):(style.innerHTML=styleText);state.init()};

var hasPushState=!!window.history&&(typeof window.history.pushState=="function");Tale.prototype.canBookmark=function(){return this.canUndo()&&(this.storysettings.lookup("bookmark")||!hasPushState)};History.prototype.init=function(){var a=this;if(!this.restore()){this.display("Start",null)}if(!hasPushState){this.hash=window.location.hash;this.interval=window.setInterval(function(){a.watchHash()},250)}};History.prototype.display=function(title,b,type,callback){var bookmarkhref,c=tale.get(title),p=document.getElementById("passages");if(type!="back"){this.history.unshift({passage:c,variables:clone(this.history[0].variables)});if(typeof callback=="function"){callback();this.history[1]&&(this.history[1].linkVars=delta(this.history[1].variables,this.history[0].variables))}if(hasPushState&&tale.canUndo()){if(this.history.length<=2&&window.history.state==""){window.history.replaceState(this.history,document.title)}else{window.history.pushState(this.history,document.title)}}}bookmarkhref=this.save();var e=c.render();if(type!="quietly"){if(hasTransition){for(var i=0;i<p.childNodes.length;i+=1){var q=p.childNodes[i];q.classList.add("transition-out");setTimeout((function(a){return function(){if(a.parentNode){a.parentNode.removeChild(a)}}}(q)),1000)}e.classList.add("transition-in");setTimeout(function(){e.classList.remove("transition-in")},1);e.style.visibility="visible";p.appendChild(e)}else{removeChildren(p);p.appendChild(e);fade(e,{fade:"in"})}}else{p.appendChild(e);e.style.visibility="visible"}if(tale.canUndo()){if(!hasPushState&&type!="back"){this.hash=bookmarkhref;window.location.hash=this.hash}else{if(tale.canBookmark()){var bookmark=document.getElementById("bookmark");bookmark&&(bookmark.href=bookmarkhref)}}}window.scroll(0,0);return e};History.prototype.watchHash=function(){if(window.location.hash!=this.hash){if(window.location.hash&&(window.location.hash!="#")){this.history=[{passage:null,variables:{}}];removeChildren(document.getElementById("passages"));if(!this.restore()){alert("The passage you had previously visited could not be found.")}}else{window.location.reload()}this.hash=window.location.hash}};History.prototype.restart=function(){if(!hasPushState){window.location.hash=""}else{window.history.replaceState(this.history,document.title,window.location.href.replace(/#.*$/,""));window.location.reload()}};Passage.prototype.render=function(){var b=insertElement(null,"div","passage"+this.title,"passage");b.style.visibility="hidden";this.setTags(b);this.setCSS();insertElement(b,"div","","header");var a=insertElement(b,"div","","body content");for(var i in prerender){(typeof prerender[i]=="function")&&prerender[i].call(this,a)}new Wikifier(a,this.processText());insertElement(b,"div","","footer");for(i in postrender){(typeof postrender[i]=="function")&&postrender[i].call(this,a)}return b};Passage.prototype.excerpt=function(){var b=this.text.replace(/<<.*?>>/g,"");b=b.replace(/!.*?\n/g,"");b=b.replace(/[\[\]\/]/g,"");var a=b.split("\n");while(a.length&&a[0].length==0){a.shift()}var c="";if(a.length==0||a[0].length==0){c=this.title}else{c=a[0].substr(0,30)+"..."}return c};Passage.transitionCache="";Passage.prototype.setCSS=function(){var trans=false,text="",tags=this.tags||[],c=document.getElementById("tagCSS"),c2=document.getElementById("transitionCSS");if(c&&c.getAttribute("data-tags")!=tags.join(" ")){tale.forEachStylesheet(tags,function(passage){if(~passage.tags.indexOf("transition")){if(!Passage.transitionCache&&c2){Passage.transitionCache=c2.innerHTML}setTransitionCSS(passage.text);trans=true}else{text+=alterCSS(passage.text)}});if(!trans&&Passage.transitionCache&&c2){setTransitionCSS(Passage.transitionCache);trans=false;Passage.transitionCache=""}c.styleSheet?(c.styleSheet.cssText=text):(c.innerHTML=text);c.setAttribute("data-tags",tags.join(" "))}};Wikifier.createInternalLink=function(place,title,callback){var el=insertElement(place,"a",title);if(tale.has(title)){el.className="internalLink"}else{el.className="brokenLink"}el.onclick=function(){state.display(title,el,null,callback)};if(place){place.appendChild(el)}return el};var Interface={init:function(){var snapback=document.getElementById("snapback"),restart=document.getElementById("restart"),bookmark=document.getElementById("bookmark");main();if(snapback){if(!tale.lookup("tags","bookmark").length){snapback.parentNode.removeChild(snapback)}else{snapback.onclick=Interface.showSnapback}}if(bookmark&&(!tale.canBookmark()||!hasPushState)){bookmark.parentNode.removeChild(bookmark)}restart&&(restart.onclick=Interface.restart)},restart:function(){if(confirm("Are you sure you want to restart this story?")){window.state.restart()}},showSnapback:function(a){Interface.hideAllMenus();Interface.buildSnapback();Interface.showMenu(a,document.getElementById("snapbackMenu"))},buildSnapback:function(){var b,c=false,state=window.state,menuelem=document.getElementById("snapbackMenu");while(menuelem.hasChildNodes()){menuelem.removeChild(menuelem.firstChild)}for(var a=state.history.length-1;a>=0;a--){if(state.history[a].passage&&state.history[a].passage.tags.indexOf("bookmark")!=-1){b=document.createElement("div");b.pos=a;b.onclick=function(){var p=this.pos;var n=state.history[p].passage.title;while(p>=0){if(state.history.length>1){state.history.shift()}p--}state.display(n)};b.innerHTML=state.history[a].passage.excerpt();menuelem.appendChild(b);c=true}}if(!c){b=document.createElement("div");b.innerHTML="<i>No passages available</i>";document.getElementById("snapbackMenu").appendChild(b)}},hideAllMenus:function(){document.getElementById("snapbackMenu").style.display="none"},showMenu:function(b,a){if(!b){b=window.event}var c={x:0,y:0};if(b.pageX||b.pageY){c.x=b.pageX;c.y=b.pageY}else{if(b.clientX||b.clientY){c.x=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;c.y=b.clientY+document.body.scrollTop+document.documentElement.scrollTop}}a.style.top=c.y+"px";a.style.left=c.x+"px";a.style.display="block";document.onclick=Interface.hideAllMenus;b.cancelBubble=true;if(b.stopPropagation){b.stopPropagation()}}};window.onload=Interface.init;macros.back.onclick=function(back,steps){if(back){if(tale.canUndo()){window.history.go(-steps);return}else{while(steps>=0){if(state.history.length>1){state.history.shift()}steps--}}state.display(state.history[0].passage.title)}else{state.display(state.history[steps].passage.title)}};window.onpopstate=function(e){if(e.state&&e.state.length>0){state.history=e.state;state.display(state.history[0].passage.title,null,"back")}};

}());
</script>
<script title="modules">


</script>
<style id="baseCSS">
body {
	background-color: #000;
	color: #fff;
	font-family: Verdana,sans-serif;
	font-size: 62.5%;
	margin: 4em 15% 5% 5em;
}
#sidebar {
	position: absolute;
	width: 12em;
	list-style: none;
	margin: 0;
	padding: 0 1em 0 0;
	font: bold 1.1em Verdana,sans-serif;
}
#sidebar li {
	color: #333;
	text-align: right;
	background-repeat: no-repeat;
	margin-bottom: 1em;
	line-height: 1.4em !important;
	list-style: none;
}
#sidebar li:hover {
	color: #fff;
	cursor: pointer;
}
#sidebar li a {
	color: #333;
	text-decoration: none;
}
#sidebar li a:hover {
	color: #fff;
	text-decoration: none;
}
#sidebar #title {
	color: #999;
	font-size: 150%;
	cursor: auto;
}
#sidebar #title a {
	color: #999;
}
#sidebar #title a:hover {
	color: #fff;
}
#sidebar 
#storySubtitle {
	font-size: 75%;
	display: block;
}
#storyAuthor {
	font-size: 50%;
}
#sidebar #storyMenu {
	display: none;
	line-height: 2.5em;
	margin-bottom: .5em;
}
#sidebar #title:hover {
	color: #999;
}
#sidebar #credits {
	padding-top: 2em;
	font-weight: normal;
	font-size: 80%;
	cursor: auto;
}
#sidebar #credits:hover {
	color: #333;
}
#sidebar #credits a {
	text-decoration: none;
}
.menu {
	position: absolute;
	display: none;
	background-color: #343434;
	color: #fff;
	opacity: .9;
	border: 1px solid #fff;
	text-align: left;
	font: 1.1em Verdana;
	line-height: 2em;
}
.menu div {
	padding: 0 .4em;
}
.menu div:hover {
	cursor: pointer;
	background-color: #fff;
	color: #343434;
}
#passages {
	margin-left: 18.2em;
	border-left: 1px solid #333;
	padding-left: 1.5em;
	position:relative;
}
.passage {
	font-size: 1.2em;
	line-height: 175%;
	margin-bottom: 2em;
	text-align: left;
}
.passage ul {
	padding-top: 1.3em;
}
.passage li {
	margin-right: 6em;
}
.passage center {
	max-width:50%;
	margin:auto;
}
.passage a {
	color: #4d6ad8;
	font-weight: bold;
	text-decoration: none;
	cursor: pointer;
}
.passage a:hover {
	color: #8ea6ff;
	text-decoration: underline;
}
a.brokenLink {
	background-color: red;
	text-decoration: none;
	color: #000;
}
.disabled {
	font-weight: bold;
	color: #333;
}
.marked {
	background-color: red;
	color: #000;
	margin-right: 12px;
	padding: 3px;
}
.marked[title] {
	cursor: help;
}
.passage ul {
	margin-left: .5em;
	padding-left: 1.5em;
}
.passage ol {
	margin-left: .5em;
	padding-left: 1.5em;
}
.passage table {
	border-collapse: collapse;
	font-size: 100%;
	margin: .8em 1.0em;
}
.passage th,.passage td,.passage tr,.passage caption {
	padding: 3px;
}
.passage hr {
	height: 1px;
}
#storeArea {
	display: none;
}
#noscript {
	margin-left: 18.2em;
	font-size: 1.2em;
	font-weight: bold;
}
</style>
<style id="transitionCSS">
.transition-in {
	opacity:0;
	position:absolute;
}
.passage:not(.transition-out) {
	transition: 1s;
	-webkit-transition: 1s;
}
#passages .transition-out {
	opacity:0 !important;
	position:absolute;
}
</style>
<style id="storyCSS"></style>
<style id="tagCSS"></style>
</head>
<body>
<ul id="sidebar">
<li id="title"><span id="storyTitle"></span><span id="storySubtitle"></span><span id="titleSeparator"></span><span id="storyAuthor"></span></li>
<li id="storyMenu"></li>
<li id="snapback">Rewind</li>
<li id="restart">Restart</li>
<li><a id="bookmark" title="Permanent link to this passage">Bookmark</a></li>
<li id="credits">
This story was created with <a href="http://twinery.org/">Twine</a> and is powered by <a href="http://tiddlywiki.com/">TiddlyWiki</a>
</li>
</ul>
<div id="snapbackMenu" class="menu"></div>
<div id="passages">
<noscript><div id="noscript">Please enable Javascript to play this story!</div></noscript>
<style>#sidebar{display:none;}</style>
</div>
<div id="storeArea"><div tiddler="theSummit" tags="" modified="201404281515" created="201404281515" twine-position="990,570" modifier="twee"></div><div tiddler="StorySettings" tags="" modified="201404272255" created="201404271621" twine-position="10,430" modifier="twee">--let the player undo moves? (on / off)\n--in sugarcane, this enables the browser's back button.\n--in jonah, this lets the player click links in previous\n--passages.\n\nundo: off\n\n--let the player use bookmarks? (on / off)\n--this enables the bookmark links in jonah and sugarcane\n--(if the player can't undo, bookmarks are always disabled.)\nbookmark: off\n\n--obfuscate the story's html source to prevent possible\n--spoilers? (swap / off)\n\nobfuscate: on\n\n--string of letter pairs to use for swap-style obfuscation\n\nobfuscatekey: 562951413\n\n--include the jquery script library? (on / off)\n\njquery: off\n\n--include the modernizr script library? (on / off)\n\nmodernizr: off\n</div><div tiddler="thatOneRoom" tags="" modified="201404280115" created="201404280115" twine-position="1130,290" modifier="twee">This is where you died. Initially. The first time. Become one with your death again and leave this purgatory already.</div><div tiddler="navigateTheDarkness" tags="" modified="201404280236" created="201404280023" twine-position="570,570" modifier="twee">&lt;&lt;if $deaths lte 1&gt;&gt;Slowly crawling off of the 'bed' you awoke on reveals a surprisingly warm but solid flooring. Its surface feels marred, cracked, and weathered. Not only is slightly warm but it feels as though it may be emanating heat. You consider [[crawling back|thePit]] to where you came from, the idea that wherever 'here' is has a tepid floor and impenetrable darkness is just a tad unnerving.\n\nDespite having no idea where you are or what lies before you the idea of [[moving forward|intoTheDarkness]] and exploring more of your environment whispers quietly in the back of your mind.\n&lt;&lt;else if $deaths eq 2&gt;&gt;Slowly crawling off of the 'bed' you awoke on reveals a surprisingly warm but solid flooring. Its surface feels marred, cracked, and weathered. Not only is slightly warm but it feels as though it may be emanating heat. You consider [[crawling back|thePit]] to where you came from, the idea of wherever it is that you are having a tepid floor &lt;html&gt;&lt;i&gt;is&lt;/i&gt;&lt;/html&gt; a bit unnerving.\n\nDespite having no idea where you are or what lies before you the idea of [[moving forward|intoTheDarkness]] and exploring more of your environment whispers quietly in the back of your [[mind|personalHistory]].&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="light" tags="" modified="201404280059" created="201404280059" twine-position="850,10" modifier="twee"></div><div tiddler="personalHistory" tags="" modified="201404280057" created="201404280055" twine-position="290,990" modifier="twee">/*add story here*/\s\nYou are a person!\n\n[[goback|previous()]]</div><div tiddler="intoTheDarkness" tags="" modified="201404281514" created="201404280057" twine-position="710,710" modifier="twee">Crawling further into the darkness you come upon what feels like an incline. The floor gets rougher and a faint, warm breeze drifts against your face. [[Turning back|thePit]] to head to more familiar terrain is something that nags at that back of your head as you [[continue forward|theSummit]]</div><div tiddler="feelTheDarkness" tags="" modified="201404281627" created="201404280024" twine-position="710,570" modifier="twee">Carefully feeling your way around the 'bed' you awoke on you realize that it is really more of a large stone tablet.</div><div tiddler="fakeStart" tags="" modified="201404281519" created="201404271725" twine-position="570,290" modifier="twee">&lt;&lt;if $deaths eq 0&gt;&gt;YOU WIN\n&lt;&lt;else if $deaths eq 1&gt;&gt;You awake with a start, opening your eyes to darkness, immediatly aware that whatever you are lying on is not your bed. The blackness surrounding you is formidable. [[Peering|peerTheDarkness]] deeply into the black stillness around you is a frightening prospect, but not nearly as terrifying as the idea of [[navigating|navigateTheDarkness]] your way around it without some form of lumination to help guide you.\n&lt;&lt;else if $deaths eq 2&gt;&gt;You awake with a start, opening your eyes to darkness, immediatly aware that whatever you are lying on is not your bed. The blackness surrounding you is formidable. [[Peering|peerTheDarkness]] deeply into the black stillness around you is a frightening prospect, but not nearly as terrifying as the idea of [[navigating|navigateTheDarkness]] your way around it without some form of lumination to help guide you. You consider for a brief moment to [[feel|feelTheDarkness]] around the surface of whatever object you are currently reclining on to get a better idea of your immediate surroundings.\n&lt;&lt;else&gt;&gt;You awake with a start, opening your eyes to darkness, immediatly aware that whatever you are lying on is not your bed. The blackness surrounding you is formidable. [[Peering|peerTheDarkness]] deeply into the black stillness around you is a frightening prospect, but not nearly as terrifying as the idea of [[navigating|navigateTheDarkness]] your way around it without some form of [[lumination|light]] to help guide you. You consider for a brief moment to [[feel|feelTheDarkness]] around the surface of whatever object you are currently reclining on to get a better idea of your immediate surroundings.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="Start" tags="startSheet noTrans" modified="201404272325" created="201404271522" twine-position="10,10" modifier="twee">&lt;html&gt;&lt;span class=&quot;title&quot;&gt;Deeper&lt;/span&gt;&lt;/html&gt;\n&lt;html&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by &lt;a href=&quot;http://shasharala.tk&quot; target=&quot;_blank&quot;&gt;shasharala&lt;/a&gt;&lt;/html&gt;\n\n\n\n\n\n\n\nAn entry into Ludum Dare 29 Jam.\n\n\n[[&lt;html&gt;&lt;span class=&quot;startButton&quot;&gt;Start&lt;/span&gt;&lt;/html&gt;|introOne]]</div><div tiddler="Stylesheet" tags="stylesheet" modified="201404280017" created="201404272033" twine-position="10,570" modifier="twee">body {\n	background-color: #101010;\n	color: #AAAAAA;\n	font-size: 21px;\n}\n\n/*HIDE SIDEBAR/PASSAGES BORDER*/\n#sidebar {visibility:hidden}\n\n#passages {\n	margin: 0px;\n	border-left: 0px;\n}\n\n.passage a {\n	color: #660000;\n}\n\n.passage a:hover {\n	color: #8A0000;\n	text-decoration: none;\n}\n\n/*REPLACE MACRO SET*/\n.revision-span-in {\n	opacity: 0;\n}\n.revision-span:not(.revision-span-out) {\n	transition: 1s; -webkit-transition: 1s;\n}\n.revision-span-out {\n	position:absolute;\n	opacity: 0;\n}</div><div tiddler="No Transition" tags="stylesheet noTrans" modified="201404272023" created="201404272014" twine-position="150,10" modifier="twee">.transition-out { display:none;}\n.transition-in {display:none;}</div><div tiddler="Replace Macro Set" tags="script" modified="201404272049" created="201404272048" twine-position="10,710" modifier="twee">(function(){version.extensions.replaceMacrosCombined={major:1,minor:1,revision:4};var nullobj={handler:function(){}};function showVer(n,notrans){if(!n){return\n}n.innerHTML=&quot;&quot;;new Wikifier(n,n.tweecode);n.setAttribute(&quot;data-enabled&quot;,&quot;true&quot;);n.style.display=&quot;inline&quot;;n.classList.remove(&quot;revision-span-out&quot;);\nif(!notrans){n.classList.add(&quot;revision-span-in&quot;);if(n.timeout){clearTimeout(n.timeout)}n.timeout=setTimeout(function(){n.classList.remove(&quot;revision-span-in&quot;);\nn=null},1)}}function hideVer(n,notrans){if(!n){return}n.setAttribute(&quot;data-enabled&quot;,&quot;false&quot;);n.classList.remove(&quot;revision-span-in&quot;);\nif(n.timeout){clearTimeout(n.timeout)}if(!notrans){n.classList.add(&quot;revision-span-out&quot;);n.timeout=setTimeout(function(){if(n.getAttribute(&quot;data-enabled&quot;)==&quot;false&quot;){n.classList.remove(&quot;revision-span-out&quot;);\nn.style.display=&quot;none&quot;;n.innerHTML=&quot;&quot;}n=null},1000)}else{n.style.display=&quot;none&quot;;n.innerHTML=&quot;&quot;;n=null}}function tagcontents(b,starttags,desttags,endtags,k){var l=0,c=&quot;&quot;,tg,a,i;\nfunction tagfound(i,e){for(var j=0;j&lt;e.length;j++){if(a.indexOf(&quot;&lt;&lt;&quot;+e[j],i)==i){return e[j]}}}a=b.source.slice(k);for(i=0;\ni&lt;a.length;i++){if(tg=tagfound(i,starttags)){l++}else{if((tg=tagfound(i,desttags))&&l==0){b.nextMatch=k+i+tg.length+4;return[c,tg]\n}else{if(tg=tagfound(i,endtags)){l--;if(l&lt;0){return null}}}}c+=a.charAt(i)}return null}var begintags=[];var endtags=[];function revisionSpanHandler(g,e,f,b){var k=b.source.indexOf(&quot;&gt;&gt;&quot;,b.matchStart)+2,vsns=[],vtype=e,flen=f.length,becomes,c,cn,m,h,vsn;\nfunction mkspan(vtype){h=insertElement(m,&quot;span&quot;,null,&quot;revision-span &quot;+vtype);h.setAttribute(&quot;data-enabled&quot;,false);h.style.display=&quot;none&quot;;\nh.tweecode=&quot;&quot;;return h}if(this.shorthand&&flen){while(f.length&gt;0){vsns.push([f.shift(),(this.flavour==&quot;insert&quot;?&quot;gains&quot;:&quot;becomes&quot;)])\n}}else{if(this.flavour==&quot;insert&quot;||(this.flavour==&quot;continue&quot;&&this.trigger==&quot;time&quot;)){vsns.push([&quot;&quot;,&quot;becomes&quot;])}}if(this.flavour==&quot;continue&quot;&&flen){b.nextMatch=k+b.source.slice(k).length;\nvsns.push([b.source.slice(k),vtype])}else{becomes=[&quot;becomes&quot;,&quot;gains&quot;];c=tagcontents(b,begintags,becomes.concat(endtags),endtags,k);\nif(c&&endtags.indexOf(c[1])==-1){while(c){vsns.push(c);c=tagcontents(b,begintags,becomes,endtags,b.nextMatch)}c=tagcontents(b,begintags,[&quot;end&quot;+e],endtags,b.nextMatch)\n}if(!c){throwError(g,&quot;can't find matching end&quot;+e);return}vsns.push(c);if(this.flavour==&quot;continue&quot;){k=b.nextMatch;b.nextMatch=k+b.source.slice(k).length;\nvsns.push([b.source.slice(k),&quot;&quot;])}}if(this.flavour==&quot;remove&quot;){vsns.push([&quot;&quot;,&quot;becomes&quot;])}cn=0;m=insertElement(g,&quot;span&quot;,null,e);\nm.setAttribute(&quot;data-flavour&quot;,this.flavour);h=mkspan(&quot;initial&quot;);vsn=vsns.shift();h.tweecode=vsn[0];showVer(h,true);while(vsns.length&gt;0){if(vsn){vtype=vsn[1]\n}vsn=vsns.shift();h=mkspan(vtype);h.tweecode=vsn[0]}if(typeof this.setup==&quot;function&quot;){this.setup(m,g,f)}}function quantity(m){return(m.children.length-1)+(m.getAttribute(&quot;data-flavour&quot;)==&quot;remove&quot;)\n}function revisionSetup(m,g,f){m.className+=&quot; &quot;+f[0].replace(&quot; &quot;,&quot;_&quot;)}function keySetup(m,g,f){var key=f[0];m.setEventListener(&quot;keydown&quot;,function l(e){var done=!revise(&quot;revise&quot;,m);\nif(done){m.removeEventListener(&quot;keydown&quot;,l)}})}function timeSetup(m,g,f){function cssTimeUnit(s){if(typeof s==&quot;string&quot;){if(s.slice(-2).toLowerCase()==&quot;ms&quot;){return Number(s.slice(0,-2))||0\n}else{if(s.slice(-1).toLowerCase()==&quot;s&quot;){return Number(s.slice(0,-1))*1000||0}}}throwError(g,s+&quot; isn't a CSS time unit&quot;);\nreturn 0}var tm=cssTimeUnit(f[0]);setTimeout(function timefn(){var done=!revise(&quot;revise&quot;,m);if(!done){setTimeout(timefn,tm)\n}},tm)}function hoverSetup(m){var fn,noMouseEnter=(document.head.onmouseenter!==null),m1=m.children[0],m2=m.children[1];if(!m1||!m2){return\n}m1.onmouseenter=function(e){if(this.getAttribute(&quot;data-enabled&quot;)!=&quot;false&quot;){revise(&quot;revise&quot;,this.parentNode)}};m2.onmouseleave=function(e){if(this.getAttribute(&quot;data-enabled&quot;)!=&quot;false&quot;){revise(&quot;revert&quot;,this.parentNode)\n}};if(noMouseEnter){fn=function(n){return function(e){if(!event.relatedTarget||(event.relatedTarget!=this&&!(this.compareDocumentPosition(event.relatedTarget)&Node.DOCUMENT_POSITION_CONTAINED_BY))){this[n]()\n}}};m1.onmouseover=fn(&quot;onmouseenter&quot;);m2.onmouseout=fn(&quot;onmouseleave&quot;)}m=null}function mouseSetup(m){var evt=(document.head.onmouseenter===null?&quot;onmouseenter&quot;:&quot;onmouseover&quot;);\nm[evt]=function(){var done=!revise(&quot;revise&quot;,this);if(done){this[evt]=null}};m=null}function linkSetup(m,g,f){var l=Wikifier.createInternalLink(),p=m.parentNode;\nl.className=&quot;internalLink replaceLink&quot;;p.insertBefore(l,m);l.insertBefore(m,null);l.onclick=function(){var p,done=false;if(m&&m.parentNode==this){done=!revise(&quot;revise&quot;,m);\nscrollWindowTo(m)}if(done){this.parentNode.insertBefore(m,this);this.parentNode.removeChild(this)}};l=null}function visitedSetup(m,g,f){var i,done,shv=state.history[0].variables,os=&quot;once seen&quot;,d=(m.firstChild&&(this.flavour==&quot;insert&quot;?m.firstChild.nextSibling:m.firstChild).tweecode);\nshv[os]=shv[os]||{};if(d&&!shv[os].hasOwnProperty(d)){shv[os][d]=1}else{for(i=shv[os][d];i&gt;0&&!done;i--){done=!revise(&quot;revise&quot;,m,true)\n}if(shv[os].hasOwnProperty(d)){shv[os][d]+=1}}}[{name:&quot;insert&quot;,flavour:&quot;insert&quot;,trigger:&quot;link&quot;,setup:linkSetup},{name:&quot;timedinsert&quot;,flavour:&quot;insert&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;insertion&quot;,flavour:&quot;insert&quot;,trigger:&quot;revisemacro&quot;,setup:revisionSetup},{name:&quot;later&quot;,flavour:&quot;insert&quot;,trigger:&quot;visited&quot;,setup:visitedSetup},{name:&quot;keyinsert&quot;,flavour:&quot;insert&quot;,trigger:&quot;key&quot;,setup:keySetup},{name:&quot;replace&quot;,flavour:&quot;replace&quot;,trigger:&quot;link&quot;,setup:linkSetup},{name:&quot;timedreplace&quot;,flavour:&quot;replace&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;mousereplace&quot;,flavour:&quot;replace&quot;,trigger:&quot;mouse&quot;,setup:mouseSetup},{name:&quot;hoverreplace&quot;,flavour:&quot;replace&quot;,trigger:&quot;hover&quot;,setup:hoverSetup},{name:&quot;revision&quot;,flavour:&quot;replace&quot;,trigger:&quot;revisemacro&quot;,setup:revisionSetup},{name:&quot;keyreplace&quot;,flavour:&quot;replace&quot;,trigger:&quot;key&quot;,setup:keySetup},{name:&quot;timedremove&quot;,flavour:&quot;remove&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;mouseremove&quot;,flavour:&quot;remove&quot;,trigger:&quot;mouse&quot;,setup:mouseSetup},{name:&quot;hoverremove&quot;,flavour:&quot;remove&quot;,trigger:&quot;hover&quot;,setup:hoverSetup},{name:&quot;removal&quot;,flavour:&quot;remove&quot;,trigger:&quot;revisemacro&quot;,setup:revisionSetup},{name:&quot;once&quot;,flavour:&quot;remove&quot;,trigger:&quot;visited&quot;,setup:visitedSetup},{name:&quot;keyremove&quot;,flavour:&quot;remove&quot;,trigger:&quot;key&quot;,setup:keySetup},{name:&quot;continue&quot;,flavour:&quot;continue&quot;,trigger:&quot;link&quot;,setup:linkSetup},{name:&quot;timedcontinue&quot;,flavour:&quot;continue&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;mousecontinue&quot;,flavour:&quot;continue&quot;,trigger:&quot;mouse&quot;,setup:mouseSetup},{name:&quot;keycontinue&quot;,flavour:&quot;continue&quot;,trigger:&quot;key&quot;,setup:keySetup},{name:&quot;cycle&quot;,flavour:&quot;cycle&quot;,trigger:&quot;revisemacro&quot;,setup:revisionSetup},{name:&quot;mousecycle&quot;,flavour:&quot;cycle&quot;,trigger:&quot;mouse&quot;,setup:mouseSetup},{name:&quot;timedcycle&quot;,flavour:&quot;cycle&quot;,trigger:&quot;time&quot;,setup:timeSetup},{name:&quot;keycycle&quot;,flavour:&quot;replace&quot;,trigger:&quot;key&quot;,setup:keySetup}].forEach(function(e){e.handler=revisionSpanHandler;\ne.shorthand=([&quot;link&quot;,&quot;mouse&quot;,&quot;hover&quot;].indexOf(e.trigger)&gt;-1);macros[e.name]=e;macros[&quot;end&quot;+e.name]=nullobj;begintags.push(e.name);\nendtags.push(&quot;end&quot;+e.name)});function insideDepartingSpan(elem){var r=elem.parentNode;while(!r.classList.contains(&quot;passage&quot;)){if(r.classList.contains(&quot;revision-span-out&quot;)){return true\n}r=r.parentNode}}function reviseAll(rt,rname){var rall=document.querySelectorAll(&quot;.passage [data-flavour].&quot;+rname),ret=false;\nfor(var i=0;i&lt;rall.length;i++){if(!insideDepartingSpan(rall[i])){ret=revise(rt,rall[i])||ret}}return ret}function revise(rt,r,notrans){var ind2,curr,next,ind=-1,rev=(rt==&quot;revert&quot;),rnd=(rt.indexOf(&quot;random&quot;)&gt;-1),fl=r.getAttribute(&quot;data-flavour&quot;),rc=r.childNodes,cyc=(fl==&quot;cycle&quot;),rcl=rc.length-1;\nfunction doToGainerSpans(n,fn){for(var k=n-1;k&gt;=0;k--){if(rc[k+1].classList.contains(&quot;gains&quot;)){fn(rc[k],notrans)}else{break\n}}}for(var k=0;k&lt;=rcl;k++){if(rc[k].getAttribute(&quot;data-enabled&quot;)==&quot;true&quot;){ind=k}}if(rev){ind-=1}curr=(ind&gt;=0?rc[ind]:(cyc?rc[rcl]:null));\nind2=ind;if(rnd){ind2=(ind+(Math.floor(Math.random()*rcl)))%rcl}next=((ind2&lt;rcl)?rc[ind2+1]:(cyc?rc[0]:null));var docurr=(rev?showVer:hideVer);\nvar donext=(rev?hideVer:showVer);var currfn=function(){if(!(next&&next.classList.contains(&quot;gains&quot;))||rnd){docurr(curr,notrans);\ndoToGainerSpans(ind,docurr,notrans)}};var nextfn=function(){donext(next,notrans);if(rnd){doToGainerSpans(ind2+1,donext,notrans)\n}};if(!rev){currfn();nextfn()}else{nextfn();currfn()}return(cyc?true:(rev?(ind&gt;0):(ind2&lt;rcl-1)))}macros.revert=macros.revise=macros.randomise=macros.randomize={handler:function(a,b,c){var l,rev,rname;\nfunction disableLink(l){l.style.display=&quot;none&quot;}function enableLink(l){l.style.display=&quot;inline&quot;}function updateLink(l){if(l.className.indexOf(&quot;random&quot;)&gt;-1){enableLink(l);\nreturn}var rall=document.querySelectorAll(&quot;.passage [data-flavour].&quot;+rname),cannext,canprev,i,ind,r,fl;for(i=0;i&lt;rall.length;\ni++){r=rall[i],fl=r.getAttribute(&quot;data-flavour&quot;);if(insideDepartingSpan(r)){continue}if(fl==&quot;cycle&quot;){cannext=canprev=true\n}else{if(r.firstChild.getAttribute(&quot;data-enabled&quot;)==!1+&quot;&quot;){canprev=true}if(r.lastChild.getAttribute(&quot;data-enabled&quot;)==!1+&quot;&quot;){cannext=true\n}}}var can=(l.classList.contains(&quot;revert&quot;)?canprev:cannext);(can?enableLink:disableLink)(l)}function toggleText(w){w.classList.toggle(rl+&quot;Enabled&quot;);\nw.classList.toggle(rl+&quot;Disabled&quot;);w.style.display=((w.style.display==&quot;none&quot;)?&quot;inline&quot;:&quot;none&quot;)}var rl=&quot;reviseLink&quot;;if(c.length&lt;2){throwError(a,b+&quot; macro needs 2 parameters&quot;);\nreturn}rname=c.shift().replace(&quot; &quot;,&quot;_&quot;);l=Wikifier.createInternalLink(a,null);l.className=&quot;internalLink &quot;+rl+&quot; &quot;+rl+&quot;_&quot;+rname+&quot; &quot;+b;\nvar v=&quot;&quot;;var end=false;var out=false;if(c.length&gt;1&&c[0][0]==&quot;$&quot;){v=c[0].slice(1);c.shift()}switch(c[c.length-1]){case&quot;end&quot;:end=true;\nc.pop();break;case&quot;out&quot;:out=true;c.pop();break}var h=state.history[0].variables;for(var i=0;i&lt;c.length;i++){var on=(i==Math.max(c.indexOf(h[v]),0));\nvar d=insertElement(null,&quot;span&quot;,null,rl+((on)?&quot;En&quot;:&quot;Dis&quot;)+&quot;abled&quot;);if(on){h[v]=c[i];l.setAttribute(&quot;data-cycle&quot;,i)}else{d.style.display=&quot;none&quot;\n}insertText(d,c[i]);l.appendChild(d)}l.onclick=function(){reviseAll(b,rname);var t=this.childNodes,u=this.getAttribute(&quot;data-cycle&quot;)-0,m=t.length,n,lall,i;\nif((end||out)&&u==m-(end?2:1)){if(end){n=this.removeChild(t[u+1]);n.className=rl+&quot;End&quot;;n.style.display=&quot;inline&quot;;this.parentNode.replaceChild(n,this)\n}else{this.parentNode.removeChild(this);return}}else{toggleText(t[u]);u=(u+1)%m;if(v){h[v]=c[u]}toggleText(t[u]);this.setAttribute(&quot;data-cycle&quot;,u)\n}lall=document.getElementsByClassName(rl+&quot;_&quot;+rname);for(i=0;i&lt;lall.length;i++){updateLink(lall[i])}};l=null}};macros.mouserevise=macros.hoverrevise={handler:function(a,b,c,d){var endtags=[&quot;end&quot;+b],evt=(window.onmouseenter===null?&quot;onmouseenter&quot;:&quot;onmouseover&quot;),t=tagcontents(d,[b],endtags,endtags,d.source.indexOf(&quot;&gt;&gt;&quot;,d.matchStart)+2);\nif(t){var rname=c[0].replace(&quot; &quot;,&quot;_&quot;),h=insertElement(a,&quot;span&quot;,null,&quot;hoverrevise hoverrevise_&quot;+rname),f=function(){var done=!reviseAll(&quot;revise&quot;,rname);\nif(b!=&quot;hoverrevise&quot;&&done){this[evt]=null}};new Wikifier(h,t[0]);if(b==&quot;hoverrevise&quot;){h.onmouseover=f;h.onmouseout=function(){reviseAll(&quot;revert&quot;,rname)\n}}else{h[evt]=f}h=null}}};macros.instantrevise={handler:function(a,b,c,d){reviseAll(&quot;revise&quot;,c[0].replace(&quot; &quot;,&quot;_&quot;))}};macros.endmouserevise=nullobj;\nmacros.endhoverrevise=nullobj}());</div><div tiddler="introOne" tags="noTrans" modified="201404280040" created="201404272054" twine-position="290,290" modifier="twee">You are drifting, falling, flying effortlessly into a white expanse of light that now surrounds you. As the brightness diffuses, burning itself into your retina, you quickly close your eyes in an attempt to shut it out. Startlingly, the brightness that you saw with your eyelids open is still present with them closed and getting brighter every moment. Opening your eyes and twisting about in an effort to get some form of bearing does not change what you are seeing. The light buries itself into your mind, seizing it in a fantastic moment of pain...\n&lt;&lt;timedgoto &quot;introTwo&quot; 16s&gt;&gt;</div><div tiddler="StoryTitle" tags="" modified="201404272104" created="201404271522" twine-position="10,290" modifier="twee">Deeper</div><div tiddler="introTwo" tags="noTrans" modified="201404280046" created="201404272024" twine-position="430,290" modifier="twee">&lt;&lt;set $deaths = 1&gt;&gt;\s\n&lt;&lt;timedremove 10s&gt;&gt;&lt;html&gt;&lt;font color=&quot;777777&quot;&gt;You are drifting, falling, flying effortlessly into a white expanse of light that now surrounds you. As the brightness diffuses, burning itself into your retina, you quickly close your eyes in an attempt to shut it out. Startlingly, the brightness that you saw with your eyelids open is still present with them closed and getting brighter every moment. Opening your eyes and twisting about in an effort to get some form of bearing does not change what you are seeing. The light buries itself into your mind, seizing it in a fantastic moment of pain...&lt;/font&gt;&lt;/html&gt;\n\n&lt;&lt;endtimedremove&gt;&gt;You awake with a start, opening your eyes to darkness, immediatly aware that whatever you are lying on is not your bed. The blackness surrounding you is formidable. [[Peering|peerTheDarkness]] deeply into the black stillness around you is a frightening prospect, but not nearly as terrifying as the idea of [[navigating|navigateTheDarkness]] your way around it without some form of lumination to help guide you.</div><div tiddler="StoryAuthor" tags="" modified="201404272104" created="201404271522" twine-position="10,150" modifier="twee">shasharala</div><div tiddler="thePit" tags="" modified="201404280302" created="201404280041" twine-position="570,150" modifier="twee">&lt;&lt;set $deaths += 1&gt;&gt;\s\nTurning around, you start crawling back to where you came from. Sometimes, heading back to where you have been is safer or might offer more insight. Unfortunately, this is not one of those times. In the complete darkness, you realize, to turn around is to make a poor guess as to where you came from.\n\nStanding now, striding through the nothing to find something, you walk in an attempt locate something that can be used as a point of reference. A few steps to the left, a dash behind you. You're getting frantic, the penetrating darkness, the inky, black silence. You rush in an effort to create more noise to fill the gaps but the murk swallows everything whole.\n\nSuddenly, your foot makes an effort to come into contact with what your uninformed and frightened mind tells it is floor but it fails. As quickly as the adrenaline your brain sends out in response is rushing into your bloodstream you find your center of gravity is changing.\n\nRather, you find that you're falling, flailing, and thrashing face forward into pitch darkness with no bearing of up or down and whether this fall is small.\n\n[[It isn't|fakeStart]]</div><div tiddler="timedGoTo" tags="script" modified="201404272008" created="201404272008" twine-position="150,710" modifier="twee">version.extensions.timedgotoMacro={major:1,minor:2,revision:0};\nmacros[&quot;goto&quot;]=macros.timedgoto={timer:null,handler:function(a,b,c,d){function cssTimeUnit(s){if(typeof s==&quot;string&quot;){if(s.slice(-2).toLowerCase()==&quot;ms&quot;){return +(s.slice(0,-2))||0\n}else{if(s.slice(-1).toLowerCase()==&quot;s&quot;){return +(s.slice(0,-1))*1000||0\n}}}throwError(a,s+&quot; isn't a CSS time unit&quot;);return 0}var t,d,m,s;\nt=c[c.length-1];d=d.fullArgs();m=0;if(b!=&quot;goto&quot;){d=d.slice(0,d.lastIndexOf(t));\nm=cssTimeUnit(t)}d=eval(Wikifier.parse(d));if(d+&quot;&quot;&&state&&state.init){if(macros[&quot;goto&quot;].timer){clearTimeout(macros[&quot;goto&quot;].timer)\n}s=state.history[0].passage.title;macros[&quot;goto&quot;].timer=setTimeout(function(){if(state.history[0].passage.title==s){state.display(d,a)\n}},m)}}};</div><div tiddler="stylesheetStart" tags="stylesheet startSheet" modified="201404272331" created="201404272202" twine-position="150,570" modifier="twee">body {	\n	font-size: 10px;\n	color: #AAAAAA;\n	background-color: #101010;\n}\n\na {\n	color: #AAAAAA !important;\n}\n\n.title {\n	font-size: 111px;\n	color: #8A0000;\n}\n\n.startButton {\n	position: relative;\n	background-color: #333333;\n	color: #AAAAAA;\n	height: 33px;\n	width: 333px;\n	margin-top: 0px;\n	margin-bottom: 0px;\n	margin-left: 66px;\n	margin-right: 0px;\n	padding: 8px;\n	border-style: solid;\n	border-width: 1px;\n	border-color: #AAAAAA;\n	border-radius: 8px;\n	text-align: center;\n	font-size: 33px;\n}\n\n.startButton:hover {\n	color: #8A0000;\n	background-color: #AAAAAA;\n}</div><div tiddler="peerTheDarkness" tags="" modified="201404280058" created="201404280023" twine-position="570,710" modifier="twee">You stare into the darkness till your surroundings become more recognizable.</div></div></body></html>
